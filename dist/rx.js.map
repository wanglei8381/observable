{"version":3,"file":"rx.js","sources":["../src/utils/type.js","../src/Subscription.js","../src/Subscriber.js","../src/symbol.js","../src/Observable.js","../src/do.js"],"sourcesContent":["const objectProto = Object.prototype\nconst toString = (obj) => objectProto.toString.call(obj)\n\nexport function isNull (obj) {\n  return obj === null\n}\n\nexport function isUndefined (obj) {\n  return obj === undefined\n}\n\nexport function isNil (obj) {\n  return obj == null\n}\n\nexport function isString (obj) {\n  const type = typeof obj\n  return type === 'string' || obj instanceof String\n}\n\nexport function isNumber (obj) {\n  const type = typeof obj\n  return type === 'number' || obj instanceof Number\n}\n\nexport function isBoolean (obj) {\n  return obj === true || obj === false || obj instanceof Boolean\n}\n\nexport function isSymbol (obj) {\n  const type = typeof obj\n  return type === 'symbol' || obj instanceof Symbol\n}\n\nexport function isObject (obj) {\n  const type = typeof obj\n  return obj != null && (type === 'object' || type === 'function')\n}\n\nexport function isObjectLike (obj) {\n  return obj != null && typeof obj === 'object'\n}\n\n/**\n *\n * @param obj {*}\n * @returns {boolean}\n * @example\n * eg1\n * isPlainObject(null) => false\n *\n * eg2\n * isPlainObject([1,2]) => false\n *\n * eg3\n * isPlainObject(Object.create(null)) => true\n *\n * eg4\n * function Foo(){}\n * isPlainObject(new Foo) => false\n */\nexport function isPlainObject (obj) {\n  // eg1,eg2\n  if (!isObjectLike(obj) || toString(obj) !== '[object Object]') {\n    return false\n  }\n  // eg3\n  const proto = Object.getPrototypeOf(obj)\n  if (proto === null) {\n    return true\n  }\n\n  // eg4\n  return proto.constructor === Object\n}\n\nexport function isArguments (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object Arguments]'\n}\n\nexport function isArray (obj) {\n  return Array.isArray(obj)\n}\n\n// 2^53 - 1 数组下标从0开始，最大长度length - 1\nconst MAX_SAFE_INTEGER = 9007199254740991\n/**\n *\n * @param value {*}\n * @returns {boolean}\n * @example\n * eg1\n * isLength(1) => true\n *\n * eg2\n * isLength(-1) => false\n *\n * eg3\n * isLength(1.1) => false\n *\n * eg4\n * isLength(1.1) => false\n *\n * eg5\n * isLength(9007199254740992) => false\n *\n */\nexport function isLength (value) {\n  return typeof value === 'number' && value > -1 && value <= MAX_SAFE_INTEGER && value % 1 === 0\n}\n\nexport function isArrayLike (obj) {\n  return obj !== null && typeof obj !== 'function' && isLength(obj.length)\n}\n\nexport function isBuffer (obj) {\n  return Buffer.isBuffer(obj)\n}\n\nexport function isDate (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object Date]'\n}\n\nexport function isElement (obj) {\n  return isObjectLike(obj) && obj.nodeType === 1\n}\n\nexport function isFunction (obj) {\n  if (!isObject(obj)) {\n    return false\n  }\n\n  const tag = toString(obj)\n  return tag === '[object Function]' ||\n    tag === '[object AsyncFunction]' ||\n    tag === '[object GeneratorFunction]' ||\n    tag === '[object Proxy]'\n}\n\nexport function isMap (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object Map]'\n}\n\nexport function isSet (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object Set]'\n}\n\nexport function isWeakMap (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object WeakMap]'\n}\n\nexport function isWeakSet (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object WeakSet]'\n}\n\nexport function isRegExp (obj) {\n  return isObjectLike(obj) && toString(obj) === '[object RegExp]'\n}\n\nexport function isError (obj) {\n  const tag = toString(obj)\n  return isObjectLike(obj) &&\n    (\n      tag === '[object Error]' ||\n      tag === '[object DOMException]'\n    )\n}\n","import {\n  isFunction\n} from './utils'\nexport class Subscription {\n  constructor () {\n    this._closed = false\n    this.observers = []\n  }\n\n  unsubscribe () {\n    if (this._unsubscribe) {\n      this._unsubscribe()\n    }\n    this.observers.forEach(observer => {\n      observer.unsubscribe()\n    })\n    this.observers = []\n    this._closed = true\n  }\n\n  add (observer) {\n    if (isFunction(observer)) {\n      this.observers.push({\n        unsubscribe: observer\n      })\n    } else if (observer instanceof Subscription) {\n      this.observers.push(observer)\n    }\n  }\n\n  get closed () {\n    return this._closed\n  }\n}\n","import {\n  isNil,\n  isFunction,\n  isObjectLike\n} from './utils'\nimport { Subscription } from './Subscription'\nexport class Subscriber extends Subscription {\n  constructor (next, error, complete) {\n    super()\n    if (next) {\n      this._next = next\n    }\n    if (error) {\n      this._error = error\n    }\n    if (complete) {\n      this._complete = complete\n    }\n\n    this.active = true\n  }\n\n  next (val) {\n    if (!this.active) return\n    if (this._next) {\n      try {\n        this._next(val)\n      } catch (e) {\n        this.unsubscribe()\n        this.errorSource = 'next'\n        this.errorValue = e\n      }\n    }\n  }\n\n  error (e) {\n    if (!this.active) return\n    if (this._error) {\n      try {\n        this._error(e)\n      } catch (e) {\n        this.unsubscribe()\n        this.errorSource = 'error'\n        throw e\n      }\n    } else {\n      this.unsubscribe()\n      this.errorSource = 'error'\n      throw e\n    }\n    this.unsubscribe()\n  }\n\n  complete () {\n    if (!this.active) return\n    if (this._complete) {\n      this._complete()\n    }\n    this.unsubscribe()\n  }\n\n  add (observer) {\n    if (!this.active) {\n      if (isFunction(observer)) {\n        observer()\n      } else if (observer instanceof Subscription) {\n        observer.unsubscribe()\n      }\n    } else {\n      super.add(observer)\n    }\n  }\n\n  _unsubscribe () {\n    this.active = false\n  }\n}\n\nexport const emptySubscriber = new Subscriber()\n\nexport function toSubscriber (observerOrNext, error, complete) {\n  let next = observerOrNext\n  if (isNil(observerOrNext)) return emptySubscriber\n  if (observerOrNext instanceof Subscriber) return observerOrNext\n  if (isObjectLike(observerOrNext)) {\n    next = observerOrNext.next\n    error = observerOrNext.error\n    complete = observerOrNext.complete\n  }\n  return new Subscriber(next, error, complete)\n}\n","export function getSymbolObservable () {\n  let $$observable\n\n  if (typeof Symbol === 'function') {\n    if (Symbol.observable) {\n      $$observable = Symbol.observable\n    } else {\n      $$observable = Symbol('observable')\n      Symbol.observable = $$observable\n    }\n  } else {\n    $$observable = '@@observable'\n  }\n\n  return $$observable\n}\n\nexport const observable = getSymbolObservable();\n","import { toSubscriber } from './Subscriber'\nimport { observable as $$observable } from './symbol'\nexport class Observable {\n  constructor (subscriber) {\n    this._subscriber = subscriber\n  }\n\n  lift (operator) {\n    const observable = new Observable()\n    observable.source = this\n    observable.operator = operator\n    return observable\n  }\n\n  subscribe (observerOrNext, error, complete) {\n    const observer = toSubscriber(observerOrNext, error, complete)\n\n    if (this.operator) {\n      const subscrition = toSubscriber(this.operator(observer))\n      observer.add(subscrition)\n      this.source.subscribe(subscrition)\n    } else if (this._subscriber) {\n      observer.add(this._trySubscribe(observer))\n    }\n\n    // 当在next中出错时，抛出错误对象\n    if (observer.errorValue && observer.errorSource === 'next') {\n      throw observer.errorValue\n    }\n\n    return observer\n  }\n\n  // 在订阅时出错要通知error，但不会抛出\n  _trySubscribe (observer) {\n    try {\n      return this._subscriber(observer)\n    } catch (e) {\n      observer.syncError = e\n      observer.error(e)\n    }\n  }\n\n  [$$observable] () {\n    return this\n  }\n\n  static create (subscriber) {\n    return new Observable(subscriber)\n  }\n}\n","import { Observable } from './Observable'\n\nObservable.prototype.do = function (nextOrObserver, error, complete) {\n  return this.lift(doOperator(nextOrObserver, error, complete))\n}\n\nfunction doOperator (next, error, complete) {\n  return observer => {\n    const subs = {\n      next (val) {\n        next(val)\n        observer.next(val)\n      },\n\n      error (e) {\n        error && error(e)\n        observer.error(e)\n      },\n\n      complete () {\n        complete && complete()\n        observer.complete()\n      }\n    }\n\n    return subs\n  }\n}"],"names":["const","super","Subscription","let","observable","$$observable"],"mappings":"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"}